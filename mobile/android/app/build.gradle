apply plugin: "com.android.application"
apply plugin: "org.jetbrains.kotlin.android"
apply plugin: "com.facebook.react"

/**
 * React Native Android app configuration.
 * Most defaults are fine; uncomment only what you need.
 */
react {
  /* Folders */
  // root = file("../")
  // reactNativeDir = file("../node_modules/react-native")
  // codegenDir = file("../node_modules/@react-native/codegen")
  // cliFile = file("../node_modules/react-native/cli.js")

  /* Variants */
  // debuggableVariants = ["liteDebug", "prodDebug"]

  /* Bundling */
  // nodeExecutableAndArgs = ["node"]
  // bundleCommand = "ram-bundle"
  // bundleConfig = file(../rn-cli.config.js)
  // bundleAssetName = "MyApplication.android.bundle"
  // entryFile = file("../js/MyApplication.android.js")
  // extraPackagerArgs = []

  /* Hermes Commands */
  // hermesCommand = "$rootDir/my-custom-hermesc/bin/hermesc"
  // hermesFlags = ["-O", "-output-source-map"]
}

/** Run Proguard on release (minify Java bytecode) */
def enableProguardInReleaseBuilds = false

/**
 * JSC flavor (used if Hermes is disabled)
 * For i18n support you could use:
 *   def jscFlavor = 'org.webkit:android-jsc-intl:+'
 */
def jscFlavor = 'org.webkit:android-jsc:+'

android {
ndkVersion = rootProject.ext.ndkVersion
  // ✅ Let AGP pick the right Build-Tools automatically (do NOT set buildToolsVersion)
  // buildToolsVersion rootProject.ext.buildToolsVersion  // <-- removed on purpose

  // Use the values defined in rootProject.ext (make sure ext.compileSdkVersion/targetSdkVersion are 35)
  compileSdkVersion rootProject.ext.compileSdkVersion

namespace = "com.bharatvote"

  defaultConfig {
    applicationId "com.bharatvote"
    minSdkVersion rootProject.ext.minSdkVersion
    targetSdkVersion rootProject.ext.targetSdkVersion
    versionCode 1
    versionName "1.0"
  }

  compileOptions {
    sourceCompatibility JavaVersion.VERSION_17
    targetCompatibility JavaVersion.VERSION_17
  }

  kotlinOptions {
    jvmTarget = "17"
    freeCompilerArgs += [
      "-Xjsr305=strict",
      "-Xjvm-default=all"
    ]
  }

  signingConfigs {
    debug {
      storeFile file('debug.keystore')
      storePassword 'android'
      keyAlias 'androiddebugkey'
      keyPassword 'android'
    }
  }

  buildTypes {
    debug {
      signingConfig = signingConfigs.debug
    }
    release {
      // ⚠️ For production, use your own release keystore
      signingConfig = signingConfigs.debug
      minifyEnabled enableProguardInReleaseBuilds
      proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
    }
  }
}

dependencies {
  // The version of react-native is set by the React Native Gradle Plugin
  implementation("com.facebook.react:react-android")
  implementation("com.facebook.react:flipper-integration")

  if (hermesEnabled.toBoolean()) {
    implementation("com.facebook.react:hermes-android")
  } else {
    implementation jscFlavor
  }
}

/*
 * Do NOT put Kotlin warning/Werror overrides here — they won’t affect other
 * modules like :gradle-plugin. Instead, add the global override in
 * android/build.gradle (project-level):
 *
 * subprojects {
 *   afterEvaluate {
 *     tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach { t ->
 *       t.kotlinOptions {
 *         allWarningsAsErrors = false
 *         freeCompilerArgs = freeCompilerArgs.findAll { it != '-Werror' }
 *       }
 *     }
 *   }
 * }
 */

apply from: file("../../node_modules/@react-native-community/cli-platform-android/native_modules.gradle"); 
applyNativeModulesAppBuildGradle(project)
